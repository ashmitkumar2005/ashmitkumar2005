# name: Experimental Animated Pac-Man Graph

# on:
#   schedule:
#     - cron: "0 */24 * * *"
#   workflow_dispatch:

# jobs:
#   generate:
#     runs-on: ubuntu-latest
#     permissions:
#       contents: write

#     steps:
#       - name: Checkout repo
#         uses: actions/checkout@v3

#       - name: Generate Base Pac-Man SVG
#         uses: abozanona/pacman-contribution-graph@main
#         with:
#           github_user_name: ${{ github.repository_owner }}
#           smooth_paths: true
#           path_thickness: 2.0
#           path_color: "#444444"
#           pacman_color: "#ffcc00"
#           ghost_color_style: "classic"
#           background_color: "transparent"
#           cell_size: 12
#           spacing: 3

#       - name: Inject Animations
#         run: |
#           FILE="dist/pacman-contribution-graph.svg"

#           # Pac-Man mouth animation
#           sed -i 's/<circle/<circle><animate attributeName="r" values="12;8;12" dur="0.4s" repeatCount="indefinite" \/>/' $FILE

#           # Pac-Man glow
#           sed -i 's/fill="#ffcc00"/fill="#ffcc00"><animate attributeName="fill" values="#ffcc00;#ffee88;#ffcc00" dur="1s" repeatCount="indefinite" \/><\/circle>/' $FILE

#           # Ghost blink animation
#           sed -i 's/fill="#ff0000"/fill="#ff0000"><animate attributeName="opacity" values="1;0.4;1" dur="1.2s" repeatCount="indefinite" \/><\/circle>/' $FILE

#           # Maze glow (path pulse)
#           sed -i 's/stroke="#444444"/stroke="#444444"><animate attributeName="stroke" values="#444444;#22c55e;#444444" dur="3s" repeatCount="indefinite" \/><\/path>/' $FILE

#       - name: Publish Animated SVG
#         uses: crazy-max/ghaction-github-pages@v2.1.3
#         with:
#           target_branch: output


# =========================
# 3D SNAKE MODE
# =========================
- name: 3D Snake Grid Animation
  if: ${{ github.event.inputs.game == 'snake3d' }}
  run: |
    mkdir -p dist
    cat << 'EOF' > dist/heatmap.svg
<svg width="100%" height="260" viewBox="0 0 1400 260" xmlns="http://www.w3.org/2000/svg">

  <!-- ==== BACKGROUND ==== -->
  <defs>
    <linearGradient id="bgGrad" x1="0" x2="1" y1="0" y2="1">
      <stop offset="0%" stop-color="#0a0f1f"/>
      <stop offset="100%" stop-color="#111827"/>
    </linearGradient>

    <!-- 3D cube shading -->
    <linearGradient id="cube" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#1f2937"/>
      <stop offset="100%" stop-color="#111827"/>
    </linearGradient>

    <!-- Snake glow -->
    <linearGradient id="snakeGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#22c55e"/>
      <stop offset="100%" stop-color="#4ade80"/>
    </linearGradient>
  </defs>

  <rect width="100%" height="100%" fill="url(#bgGrad)" />

  <!-- ==== 3D GRID ==== -->
  <g opacity="0.7">
    <!-- generate 3D grid cubes -->
    <script type="application/ecmascript"><![CDATA[
      const svg = document.currentScript.parentNode;
      let size = 24;
      for (let x = 0; x < 1400; x += size) {
        for (let y = 0; y < 260; y += size) {
          let cube = document.createElementNS("http://www.w3.org/2000/svg","rect");
          cube.setAttribute("x", x);
          cube.setAttribute("y", y);
          cube.setAttribute("width", size-2);
          cube.setAttribute("height", size-2);
          cube.setAttribute("fill", "url(#cube)");
          svg.appendChild(cube);
        }
      }
    ]]></script>
  </g>

  <!-- ==== SNAKE ==== -->
  <g id="snake">
    <rect id="snakeHead" x="0" y="120" width="24" height="24" rx="4" fill="url(#snakeGrad)">
      <animate attributeName="x"
               values="0;200;400;600;800;1000;1200;1400"
               dur="6s"
               repeatCount="indefinite" />
      <animate attributeName="y"
               values="120;80;120;160;120"
               dur="3s"
               repeatCount="indefinite" />
    </rect>

    <!-- Tail segments -->
    <rect x="0" y="120" width="20" height="20" rx="4" fill="#16a34a" opacity="0.8">
      <animate attributeName="x"
               values="-30;170;370;570;770;970;1170;1370"
               dur="6s"
               repeatCount="indefinite" />
      <animate attributeName="y"
               values="120;80;120;160;120"
               dur="3s"
               repeatCount="indefinite" />
    </rect>

    <rect x="0" y="120" width="16" height="16" rx="4" fill="#15803d" opacity="0.6">
      <animate attributeName="x"
               values="-60;140;340;540;740;940;1140;1340"
               dur="6s"
               repeatCount="indefinite" />
      <animate attributeName="y"
               values="120;80;120;160;120"
               dur="3s"
               repeatCount="indefinite" />
    </rect>
  </g>

</svg>
EOF

#           build_dir: dist
#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
