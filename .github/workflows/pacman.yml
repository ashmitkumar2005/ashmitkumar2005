name: Heatmap Game Engine

on:
  workflow_dispatch:
    inputs:
      game:
        description: "Choose the heatmap game"
        required: true
        default: "pacman"
        type: string

  schedule:
    - cron: "0 */24 * * *"

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout
        uses: actions/checkout@v3


      # ============================
      # MODE 1: PAC-MAN (OFFICIAL)
      # ============================
      - name: Pac-Man Game
        if: ${{ github.event.inputs.game == 'pacman' }}
        uses: abozanona/pacman-contribution-graph@main
        with:
          github_user_name: ${{ github.repository_owner }}
          smooth_paths: true
          path_thickness: 2
          path_color: "#444444"
          pacman_color: "#ffcc00"
          ghost_color_style: "classic"
          background_color: "transparent"
          cell_size: 12
          spacing: 3


      # ============================
      # MODE 2: 3D SNAKE GAME (SVG)
      # ============================
      - name: 3D Snake Game
        if: ${{ github.event.inputs.game == 'snake3d' }}
        run: |
          mkdir -p dist
          cat << 'EOF' > dist/heatmap.svg
<svg width="100%" height="260" viewBox="0 0 1400 260" xmlns="http://www.w3.org/2000/svg">

  <defs>
    <linearGradient id="bgGrad" x1="0" x2="1" y1="0" y2="1">
      <stop offset="0%" stop-color="#0a0f1f"/>
      <stop offset="100%" stop-color="#111827"/>
    </linearGradient>

    <linearGradient id="cube" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#1f2937"/>
      <stop offset="100%" stop-color="#111827"/>
    </linearGradient>

    <linearGradient id="snakeGrad" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#22c55e"/>
      <stop offset="100%" stop-color="#4ade80"/>
    </linearGradient>
  </defs>

  <rect width="100%" height="100%" fill="url(#bgGrad)" />

  <!-- Snake head -->
  <rect x="0" y="120" width="28" height="28" rx="6" fill="url(#snakeGrad)">
    <animate attributeName="x"
             values="0;200;400;600;800;1000;1200;1400"
             dur="6s"
             repeatCount="indefinite" />
    <animate attributeName="y"
             values="120;80;120;160;120"
             dur="3s"
             repeatCount="indefinite" />
  </rect>

  <!-- Snake tail -->
  <rect x="-40" y="120" width="20" height="20" rx="4" fill="#15803d" opacity="0.7">
    <animate attributeName="x"
             values="-40;160;360;560;760;960;1160;1360"
             dur="6s"
             repeatCount="indefinite" />
    <animate attributeName="y"
             values="120;80;120;160;120"
             dur="3s"
             repeatCount="indefinite" />
  </rect>

</svg>
EOF


      # =====================================
      # PUBLISH TO OUTPUT BRANCH
      # =====================================
      - name: Publish to output branch
        uses: crazy-max/ghaction-github-pages@v2.1.3
        with:
          target_branch: output
          build_dir: dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
