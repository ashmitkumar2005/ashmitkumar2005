name: Experimental Animated Pac-Man Graph

on:
  schedule:
    - cron: "0 */24 * * *"
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Generate Base Pac-Man SVG
        uses: abozanona/pacman-contribution-graph@main
        with:
          github_user_name: ${{ github.repository_owner }}
          smooth_paths: true
          path_thickness: 2.0
          path_color: "#444444"
          pacman_color: "#ffcc00"
          ghost_color_style: "classic"
          background_color: "transparent"
          cell_size: 12
          spacing: 3

      - name: Inject Animations
        run: |
          FILE="dist/pacman-contribution-graph.svg"

          # Pac-Man mouth animation
          sed -i 's/<circle/<circle><animate attributeName="r" values="12;8;12" dur="0.4s" repeatCount="indefinite" \/>/' $FILE

          # Pac-Man glow
          sed -i 's/fill="#ffcc00"/fill="#ffcc00"><animate attributeName="fill" values="#ffcc00;#ffee88;#ffcc00" dur="1s" repeatCount="indefinite" \/><\/circle>/' $FILE

          # Ghost blink animation
          sed -i 's/fill="#ff0000"/fill="#ff0000"><animate attributeName="opacity" values="1;0.4;1" dur="1.2s" repeatCount="indefinite" \/><\/circle>/' $FILE

          # Maze glow (path pulse)
          sed -i 's/stroke="#444444"/stroke="#444444"><animate attributeName="stroke" values="#444444;#22c55e;#444444" dur="3s" repeatCount="indefinite" \/><\/path>/' $FILE

      - name: Publish Animated SVG
        uses: crazy-max/ghaction-github-pages@v2.1.3
        with:
          target_branch: output
          build_dir: dist
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
